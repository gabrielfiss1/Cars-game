(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();const d=async h=>new Promise(t=>{const i=new Image;i.addEventListener("load",()=>(console.log("loaded: "+h),t(i))),i.src=h,console.log("loading img: "+h)});class w{constructor(t,i,e,s=10,r="#00f"){this.x=t,this.y=i,this.size=e,this.speed=s,this.color=r,this.status="ArrowRight",this.line=3}draw(t){this.circ(t,this.x,this.y,this.size,this.line,this.color,this.color)}circ(t,i,e,s,r,n,l=!1){t.lineWidth=r,t.strokeStyle=n,t.beginPath(),t.arc(i,e,s,0,Math.PI*2),t.stroke(),l&&(t.fillStyle=l,t.fill())}move(t,i){let e={ArrowDown:{x:this.x,y:this.y+this.speed},ArrowUp:{x:this.x,y:this.y-this.speed},ArrowLeft:{x:this.x-this.speed,y:this.y},ArrowRight:{x:this.x+this.speed,y:this.y}};this.status=e[i]?i:this.status,this.x=e[this.status].x,this.y=e[this.status].y,this.limits(t)}limits(t){this.x=this.x-this.size>t.width?-2*this.size:this.x,this.x=this.x+this.size<-2*this.size?t.width:this.x,this.y=this.y-this.size>t.height+this.size?-this.size:this.y,this.y=this.y+2*this.size<0?t.height+2*this.size:this.y}anda(t,i){switch(i){case"s":this.status="down";break;case"w":this.status="up";break;case"a":this.status="left";break;case"d":this.status="right";break}switch(this.status){case"down":this.y+=this.speed;break;case"up":this.y-=this.speed;break;case"left":this.x-=this.speed;break;case"right":this.x+=this.speed;break}this.x>t.width?this.x=-this.size:this.x+this.size<0&&(this.x=t.width-this.size),this.y>t.height?this.y=-this.size:this.y+this.size<0&&(this.y=t.height-this.size)}oldColide(t){return Math.abs(this.x-t.x)<(this.size+t.size)*.9&&Math.abs(this.y-t.y)<(this.size+t.size)*.9}colide(t){return this.size+t.size>=Math.sqrt((this.x-t.x)**2+(this.y-t.y)**2)}}class b extends w{constructor(t,i,e=20,s,r,n=60){super(t,i,0),this.cellWidth=50,this.cellHeight=40,this.width=s,this.height=r,this.speed=e,this.totalSprites=3,this.spriteSpeed=10,this.loadImage(),this.setSprites(),this.status="down",this.showHit=!0,this.setHit(),this.setControlsKeys()}async loadImage(){this.img=await d("/src/img/mcqueenback.png")}draw(t){if(!this.img)return;let i=this.cellWidth,e=this.cellHeight;this.status==="down"&&(i=41,e=40);const s=this.cellWidth*this.sprites[this.status],r=0;t.drawImage(this.img,s,r,i,e,this.x,this.y,this.width,this.height),this.showHit&&this.hit.draw(t)}setHit(){this.hit=new w(this.x+this.width/2,this.y+this.height/2,this.width*.2,2,"transparent")}setSprites(){this.sprites={down:1,left:0,right:2}}setControlsKeys(){this.controls={a:"left",d:"right",ArrowLeft:"left",ArrowRight:"right",s:"down"}}setMovements(){this.movements={left:{x:this.x-this.speed,y:this.y},right:{x:this.x+this.speed,y:this.y},down:{x:this.x,y:this.y}}}update(){this.hit.x=this.x+this.width/2,this.hit.y=this.y+this.height/2}move(t,i){this.controls[i]&&(this.status=this.controls[i]),this.setMovements();let{x:e,y:s}=this.movements[this.status]||{x:this.x,y:this.y};e>=60&&e<=t.width-this.width&&(this.x=e),s>=0&&s<=t.height-this.height&&(this.y=s),this.update()}colide(t){const i=this.hit.x-t.x-t.width/2,e=this.hit.y-t.y-t.height/2;return Math.sqrt(i*i+e*e)<this.hit.size+t.width/2}}class A{constructor(t,i,e,s,r=10,n){this.x=t,this.y=i,this.width=e,this.height=s,this.speed=r,this.spritePath=n,this.img=null,this.hasPassed=!1,this.hasPlayedPassSound=!1,d(n).then(l=>{this.img=l})}draw(t){this.img?t.drawImage(this.img,this.x,this.y,this.width,this.height):(t.fillStyle=this.color||"#f00",t.fillRect(this.x,this.y,this.width,this.height))}move(t){this.y+=this.speed,this.checkIfPassed(t),this.limits(t)}checkIfPassed(t){this.y>t.height?this.hasPassed||(this.hasPassed=!0,this.hasPlayedPassSound=!1):this.hasPassed=!1}limits(t){this.y-this.height>t.height&&(this.y=-this.height,this.x=Math.random()*t.width)}}let m;function M(h){h.addEventListener("keydown",t=>{m=t.key})}let o,a;const f=45;let x,z,I=null,u=null,P;const c=new b(240,480,5,100,100,f),p=["/src/img/vilainsprite.png","/src/img/vilainsprite2.png"];function k(){return p[Math.floor(Math.random()*p.length)]}let v=[],y,g=!1;const E=async()=>{console.log("Initialize Canvas"),a=document.querySelector("canvas"),o=a.getContext("2d"),o.clearRect(0,0,a.width,a.height);try{I=await d("/src/img/mcqueenback.png"),u=await d("/src/img/roadbg.png"),P=o.createPattern(u,"repeat"),x=new Audio("/src/sounds/crash.mp3"),z=new Audio("/src/sounds/pass.mp3"),y={width:a.width,height:a.height},v=Array.from({length:2},()=>new A(Math.random()*a.width,Math.random()*-a.height,80,80,5,k())),M(window),L()}catch(h){console.error("Error initializing the game:",h)}},L=()=>{let h=setInterval(()=>{clearInterval(h),S()},1e3/f)},S=()=>{setTimeout(()=>{o.fillStyle=P,o.fillRect(0,0,a.width,a.height),o.drawImage(u,0,0,a.width,a.height),c.move(y,m),c.draw(o),v.forEach(h=>{h&&(h.move(y),h.draw(o),h.hasPassed&&!h.hasPlayedPassSound&&(z.play(),h.hasPlayedPassSound=!0),g=g?!0:c.colide(h))}),g?(o.font="50px Montserrat",o.fillStyle="red",o.textAlign="center",o.fillText("GAME OVER",a.width/2,a.height/2),x.play(),cancelAnimationFrame(anime)):requestAnimationFrame(S)},60/f)};window.addEventListener("load",E,!1);
